<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="https://unpkg.com/chota@0.9.2" />
    <title>Fetch request</title>
  </head>

  <body>
    <div id="top" class="container">
      <h1>Make fetch request using javascript</h1>
      <div class="row">
        <div class="col">Path:</div>
        <div class="col-11">
          <input type="text" id="requestUrl" value="/" />
        </div>
      </div>

      <div class="row">
        <div class="col">Body:</div>
        <div class="col-11">
          <textarea id="requestBody" rows="4">{ "message": "hello" }</textarea>
        </div>
      </div>
      <div class="row">
        <div class="col">Request:</div>
        <div class="col-11">
          <button class="button" id="get">GET</button>
          <button class="button" id="post">POST</button>
          <button class="button" id="put">PUT</button>
          <button class="button" id="delete">DELETE</button>
        </div>
      </div>

      <button class="button primary" id="clear-log">Clear logs</button>

      <div>
        <h3>Logs</h3>
        <div id="logs"></div>
      </div>

      <script type="module">
        import { Logger } from './logger.js';

        const log = new Logger(document.getElementById('logs'));

        async function makeRequest(method) {
          const url = document.getElementById('requestUrl').value;
          const body = method === 'GET' ? undefined : document.getElementById('requestBody').value;

          log.info(`Request ${method} to ${url}`, body);

          try {
            const response = await fetch(url, {
              method: method,
              headers: {
                'Content-Type': 'application/json',
              },
              body: body,
            });
            log.info(`Response status: ${response.status}`, await response.text());
          } catch (error) {
            log.error(error);
          }
        }

        document.getElementById('clear-log').addEventListener('click', () => log.clear());
        document.getElementById('get').addEventListener('click', () => makeRequest('GET'));
        document.getElementById('post').addEventListener('click', () => makeRequest('POST'));
        document.getElementById('put').addEventListener('click', () => makeRequest('PUT'));
        document.getElementById('delete').addEventListener('click', () => makeRequest('DELETE'));
      </script>
    </div>
  </body>
</html>
